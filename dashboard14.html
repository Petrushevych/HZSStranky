<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pro Hasiče</title>
  <link rel="icon" href="media/favicon.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="top-panel">
    <nav class="nav-center">
      <ul class="hlavni-menu">
        <li><a href="#vyjezd" class="active">Výjezdový záznam</a></li>
        <li><a href="#smena">Zapsání směny</a></li>
        <li><a href="#hlaseni">Hlášení o nehodě</a></li>
        <li><a href="#moje-dokumenty">Moje dokumenty</a></li>
      </ul>
      <ul id="velitelske-menu" class="hlavni-menu" style="display:none;">
        <li><a href="#statistiky">Statistiky</a></li>
        <li><a href="#sprava">Správa členů</a></li>
        <li><a href="#vsechny-dokumenty">Všechny dokumenty</a></li>
      </ul>
      <li><button id="logout-btn">Odhlásit se</button></li>
    </nav>
  </header>
      <section id="vyjezd"></section>
      <section id="smena" style="display:none;">
  <div class="wrapper">
    <div class="box">
      <h3>Zapsání směny</h3>
      <form id="smena-form">
        <div class="form-group">
          <label for="smena-datum">Datum směny:</label>
          <input type="date" id="smena-datum" />
        </div>

        <div class="form-group">
          <label for="smena-cas">Čas směny:</label>
          <input type="text" id="smena-cas" placeholder="hh:mm" />
        </div>

        <div class="form-group">
          <label for="smena-rozdeleni">Rozdělení směny:</label>
          <textarea id="smena-rozdeleni" rows="3" placeholder="Např. PSA 101 5+1, PSA 103 1+1, KOPIS, VČ..."></textarea>
        </div>

        <div class="form-group">
          <label for="smena-napln">Náplň směny:</label>
          <textarea id="smena-napln" rows="3" placeholder="Např. údržba techniky, výcvik, školení..."></textarea>
        </div>

        <div class="form-group">
          <label for="smena-vozidlo">Vozidlo:</label>
          <select id="smena-vozidlo">
            <option>PSA 100, KOPIS</option>
            <option>PSA 101, CAS 20 Scania XT</option>
            <option>PSA 102, CAS 30 Scania XT</option>
            <option>PSA 103, AZ-30 Scania XT</option>
            <option>PSA 105, VEA Ř.D Kodiaq</option>
            <option>PSA 106, RZA Volkswagen T6</option>
            <option>PSA 107, CAS 20 Tatra Terra 4x4</option>
            <option>PSA 108, TA-CH Mercedes Sprinter 4x4</option>
            <option>PSA 109, TA Ford Ranger</option>
            <option>PSA 112, CAS 30 Tatra Force</option>
            <option>PSA 115, VEA Škoda Kodiaq</option>
            <option>PSA 117, CAS 15 MAN TGM</option>
            <option>PSA 306, MOS Mercedes Sprinter 4x4</option>
          </select>
        </div>

        <div class="form-group">
          <label for="smena-duvod">Důvod výjezdu s technikou:</label>
          <select id="smena-duvod">
            <option>Kondiční jízda</option>
            <option>Jízda na místo události</option>
            <option>Ostatní</option>
          </select>
        </div>

        <div class="form-group">
          <label for="smena-palivo">Palivo v nádrži (%):</label>
          <input type="number" id="smena-palivo" min="0" max="100" />
        </div>

        <div class="form-group">
          <label for="smena-voda">Voda v nádrži (čárky):</label>
          <input type="text" id="smena-voda" placeholder="Např. 3/5" />
        </div>

        <div class="form-group">
          <label for="smena-svetla">Světla, VRZ, majáky:</label>
          <select id="smena-svetla">
            <option>Funkční</option>
            <option>Nefunkční</option>
          </select>
        </div>

        <div class="form-group">
          <label for="smena-ciste">Čisté:</label>
          <select id="smena-ciste">
            <option>Ano</option>
            <option>Ne</option>
          </select>
        </div>

        <div class="form-group">
          <label for="smena-technika">Agregáty, čerpadlo, žebřík, ostatní technika:</label>
          <select id="smena-technika">
            <option>Funkční</option>
            <option>Nefunkční</option>
          </select>
        </div>

        <div class="form-group">
          <label for="smena-poznamka">Poznámka:</label>
          <textarea id="smena-poznamka" rows="3" placeholder="Doplňující informace..."></textarea>
        </div>

        <button type="submit">Uložit směnu</button>
      </form>
    </div>
  </div>
</section>

      <section id="hlaseni" style="display:none;"></section>
      <section id="moje-dokumenty" style="display:none;"></section>
      <section id="statistiky" style="display:none;"></section>
      <section id="sprava" style="display:none;"></section>
  </div>

<div class="wrapper">
  <div class="box">
    <h2>Vítej, <span id="user-email">...</span></h2>

    <section id="vyjezd">
      <h3>Výjezdový záznam</h3>
      <form id="vyjezd-form">
        <div class="form-group">
          <label>Složky na místě:</label>
          <div class="dropdown-checkbox">
            <button type="button" id="toggle-jednotky">Vyber složky</button>
            <div id="jednotky-box" class="dropdown-content">
              <label><input type="checkbox" value="HZS"> HZS</label>
              <label><input type="checkbox" value="ZZS"> ZZS</label>
              <label><input type="checkbox" value="PČR"> PČR</label>
              <label><input type="checkbox" value="MP"> MP</label>
              <label><input type="checkbox" value="JSDH"> JSDH</label>
            </div>
          </div>
          <div id="vybrane-jednotky" class="vybrane-jednotky"></div>
        </div>

        <div class="form-group">
          <label>Datum výjezdu:</label>
          <input type="text" placeholder="dd.mm.rrrr" />
        </div>

        <div class="form-group">
          <label>Čas výjezdu:</label>
          <input type="text" placeholder="hh:mm" />
        </div>

        <div class="form-group">
          <label>Lokace události:</label>
          <input type="text" placeholder="Zadej místo" />
        </div>

        <div class="form-group">
          <label>Typ události:</label>
          <select id="typ">
            <option>Požár</option>
            <option>Dopravní nehoda</option>
            <option>Technická pomoc</option>
            <option>Únik nebezpečných látek</option>
            <option>Záchrana osob a zvířat</option>
            <option>Planý poplach</option>
            <option>Formálně založená událost</option>
            <option>Ostatní mimořádná událost</option>
            <option>Jiné, zatím neurčeno</option>
          </select>
        </div>

        <div class="form-group">
          <label>Počet zraněných:</label>
          <input type="number" min="0" />
        </div>

        <div class="form-group">
          <label>Vyjetá vozidla:</label>
          <textarea rows="2" placeholder="Např. Výjezd 1, PSA101"></textarea>
        </div>

        <div class="form-group">
          <label>Použité vybavení:</label>
          <textarea rows="2" placeholder="Např. hydraulika, dýchací technika"></textarea>
        </div>

        <div class="form-group">
          <label>Stupeň požárního poplachu:</label>
          <select id="stupen">
            <option>I. stupeň</option>
            <option>II. stupeň</option>
            <option>III. stupeň</option>
            <option>Zvláštní stupeň</option>
          </select>
        </div>

        <div class="form-group">
          <label>Stručný popis:</label>
          <textarea rows="4" placeholder="Popiš událost..."></textarea>
        </div>

        <button type="submit">Uložit záznam</button>
      </form>
    </section>

      <section id="hlaseni" style="display:none;"><h3>Hlášení o nehodě</h3><p>Sem přijde formulář pro hlášení o nehodě.</p></section>
      <section id="statistiky" style="display:none;"><h3>Statistiky</h3><p>Sem přijdou velitelské statistiky.</p></section>
      <section id="sprava" style="display:none;"><h3>Správa členů</h3><p>Sem přijde správa uživatelů a oprávnění.</p></section>

      <section id="moje-dokumenty" style="display:none;">
        <h3>Moje dokumenty</h3>
        <div id="moje-vystupy"><p>Načítám tvoje záznamy...</p></div>
      </section>

            <!-- ✅ Tady patří „Všechny dokumenty“ -->
      <section id="vsechny-dokumenty" style="display:none;">
        <h3>Všechny dokumenty</h3>

      <div class="sub-nav">
        <button onclick="zobrazPodsekci('vyjezdy')">Výjezdové záznamy</button>
        <button onclick="zobrazPodsekci('smeny')">Zapsané směny</button>
        <button onclick="zobrazPodsekci('hlaseni')">Hlášení o nehodách</button>
      </div>

      <div id="vsechny-vyjezdy" class="podsekce"></div>
      <div id="vsechny-smeny" class="podsekce" style="display:none;">
      <div id="overlay" style="display:none;"></div>
        <p>Modul pro směny připravujeme...</p>
      </div>
      <div id="vsechny-hlaseni" class="podsekce" style="display:none;">
        <p>Modul pro hlášení připravujeme...</p>
      </div>
      </section>

  <footer><p>© 2025 Hasičský záchranný sbor, FivePD Czech Community - Všechna práva vyhrazena</p></footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs, addDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
document.getElementById("toggle-jednotky").addEventListener("click", () => {
  document.querySelector(".dropdown-checkbox").classList.toggle("show");
});

// ✅ Tohle musí být mimo ten click listener
const jednotkyBox = document.getElementById("jednotky-box");
const jednotkyDisplay = document.getElementById("vybrane-jednotky");

jednotkyBox.addEventListener("change", () => {
  const vybrane = Array.from(jednotkyBox.querySelectorAll("input[type='checkbox']:checked"))
                        .map(cb => cb.value);
  jednotkyDisplay.textContent = vybrane.length
    ? "Vybrané složky: " + vybrane.join(", ")
    : "Žádné složky zatím nevybrány.";
});



    const firebaseConfig = {
      apiKey: "AIzaSyDxIReHtxYMMQS45F6LsuuUNmD9OFM52xw",
      authDomain: "strankyhzs.firebaseapp.com",
      projectId: "strankyhzs",
      storageBucket: "strankyhzs.appspot.com",
      messagingSenderId: "4241320711",
      appId: "1:4241320711:web:ec4d01e8f313d6a02333a2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const velitele = [
      "kubajzzzmusic@gmail.com",
      "velitel1@hzs.cz",
      "velitel2@hzs.cz"
    ];

onAuthStateChanged(auth, async user => {
  if (user) {
    document.getElementById("user-email").textContent = user.email;
    document.getElementById("logout-btn").style.display = "inline-block"; // ✅ zobrazit tlačítko

    if (velitele.includes(user.email)) {
      document.getElementById("velitelske-menu").style.display = "flex";
      loadAllDocuments();
    }

    loadUserDocuments(user.email);
  } else {
    window.location.href = "prohasice.html";
  }

  loadUserShifts(user.email);
if (velitele.includes(user.email)) {
  document.getElementById("velitelske-menu").style.display = "flex";
  loadAllShifts();
}

});

window.zobrazPodsekci = function(typ) {
  document.querySelectorAll(".podsekce").forEach(div => {
    div.style.display = "none";
  });
  const target = document.getElementById("vsechny-" + typ);
  if (target) target.style.display = "block";
};

    async function loadUserDocuments(email) {
      const q = query(collection(db, "vyjezdy"), where("autor", "==", email));
      const querySnapshot = await getDocs(q);
      const container = document.getElementById("moje-vystupy");
      container.innerHTML = "";

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const id = doc.id;
        const blok = document.createElement("div");
        blok.className = "dokument";
        blok.innerHTML = `
          <strong>${data.typ}</strong> – ${data.datum} ${data.cas}<br/>
          ${data.lokalizace} | ${data.popis}<br/>
          <button onclick="zobrazDetail('${id}')">Zobrazit detail</button>
        `;
        container.appendChild(blok);
      });
    }

async function loadUserShifts(email) {
  const q = query(collection(db, "smeny"), where("autor", "==", email));
  const querySnapshot = await getDocs(q);
  const container = document.getElementById("vsechny-smeny");
  container.innerHTML = "";

  querySnapshot.forEach(doc => {
    const data = doc.data();
    const box = document.createElement("div");
    box.className = "dokument";
    box.innerHTML = `
      <strong>${data.datum} ${data.cas}</strong><br/>
      Vozidlo: ${data.vozidlo} | Důvod: ${data.duvod}<br/>
      Náplň: ${data.napln}<br/>
      <button>Zobrazit detail</button>
    `;
    box.querySelector("button").addEventListener("click", () => zobrazDetailSmeny(data));
    container.appendChild(box);
  });
}

async function loadAllShifts() {
  const querySnapshot = await getDocs(collection(db, "smeny"));
  const container = document.getElementById("vsechny-smeny");
  container.innerHTML = "";

  querySnapshot.forEach(doc => {
    const data = doc.data();
    const box = document.createElement("div");
    box.className = "dokument";
    box.innerHTML = `
      <strong>${data.datum} ${data.cas}</strong><br/>
      Vozidlo: ${data.vozidlo} | Důvod: ${data.duvod}<br/>
      Náplň: ${data.napln}<br/>
      <button>Zobrazit detail</button>
    `;
    box.querySelector("button").addEventListener("click", () => zobrazDetailSmeny(data));
    container.appendChild(box);
  });
}

      async function loadAllDocuments() {
        const querySnapshot = await getDocs(collection(db, "vyjezdy"));
        const container = document.getElementById("vsechny-vyjezdy");
        container.innerHTML = "";

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const id = doc.id;
          container.innerHTML += `<div class="dokument">
            <strong>${data.typ}</strong> – ${data.datum} ${data.cas}<br/>
            ${data.lokalizace} | ${data.popis} <br/>
            <em>Autor: ${data.autor}</em><br/>
            <button onclick="zobrazDetail('${id}')">Zobrazit detail</button>
          </div><hr/>`;
        });
      }

    document.getElementById("logout-btn").addEventListener("click", () => {
      signOut(auth).then(() => window.location.href = "prohasice.html");
    });

    document.getElementById("vyjezd-form").addEventListener("submit", async e => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return alert("Nepřihlášený uživatel");

        const data = {
    autor: user.email,
    datum: document.querySelector('input[placeholder="dd.mm.rrrr"]').value,
    cas: document.querySelector('input[placeholder="hh:mm"]').value,
    lokalizace: document.querySelector('input[placeholder="Zadej místo"]').value,
    typ: document.getElementById("typ").value,
    zraneni: parseInt(document.querySelector('input[type="number"]').value),
    vozidla: document.querySelectorAll('textarea')[0].value,
    vybaveni: document.querySelectorAll('textarea')[1].value,
    stupen: document.getElementById("stupen").value,
    popis: document.querySelectorAll('textarea')[2].value,
    jednotky: Array.from(document.querySelectorAll('#jednotky-box input:checked')).map(cb => cb.value)
  };

  try {
    await addDoc(collection(db, "vyjezdy"), data);
    alert("Záznam uložen!");
    document.getElementById("vyjezd-form").reset();
    loadUserDocuments(user.email);
    if (velitele.includes(user.email)) loadAllDocuments();
  } catch (err) {
    console.error("Chyba při ukládání:", err);
    alert("Nepodařilo se uložit záznam.");
  }
});

document.getElementById("smena-form").addEventListener("submit", async e => {
  e.preventDefault();
  const user = auth.currentUser;
  if (!user) return alert("Nepřihlášený uživatel");

  const data = {
    autor: user.email,
    datum: document.getElementById("smena-datum").value,
    cas: document.getElementById("smena-cas").value,
    rozdeleni: document.getElementById("smena-rozdeleni").value,
    napln: document.getElementById("smena-napln").value,
    vozidlo: document.getElementById("smena-vozidlo").value,
    duvod: document.getElementById("smena-duvod").value,
    palivo: document.getElementById("smena-palivo").value,
    voda: document.getElementById("smena-voda").value,
    svetla: document.getElementById("smena-svetla").value,
    ciste: document.getElementById("smena-ciste").value,
    technika: document.getElementById("smena-technika").value,
    poznamka: document.getElementById("smena-poznamka").value
  };

  try {
    await addDoc(collection(db, "smeny"), data);
    alert("Směna uložena!");
    document.getElementById("smena-form").reset();
    loadUserShifts(user.email);
    if (velitele.includes(user.email)) loadAllShifts();
  } catch (err) {
    console.error("Chyba při ukládání směny:", err);
    alert("Nepodařilo se uložit směnu.");
  }
});


window.zobrazDetail = async function(id) {
  const docRef = doc(db, "vyjezdy", id);
  const docSnap = await getDoc(docRef);

  if (docSnap.exists()) {
    const data = docSnap.data();
    const html = `
      <div class="detail-okno">
        <h3>${data.typ} – ${data.datum} ${data.cas}</h3>
        <p><strong>Lokalizace:</strong> ${data.lokalizace}</p>
        <p><strong>Složky:</strong> ${data.jednotky.join(", ")}</p>
        <p><strong>Vozidla:</strong> ${data.vozidla}</p>
        <p><strong>Vybavení:</strong> ${data.vybaveni}</p>
        <p><strong>Stupeň poplachu:</strong> ${data.stupen}</p>
        <p><strong>Zranění:</strong> ${data.zraneni}</p>
        <p><strong>Popis:</strong><br/>${data.popis}</p>
        <button onclick="zavritDetail()">Zavřít</button>
      </div>
    `;
    const overlay = document.createElement("div");
    overlay.id = "overlay";
    overlay.innerHTML = html;
    document.body.appendChild(overlay);
  }
};

window.zavritDetail = function() {
  const overlay = document.getElementById("overlay");
  if (overlay) overlay.remove();
};

function zobrazDetailSmeny(data) {
  const overlay = document.getElementById("overlay");
  if (!overlay) {
    console.error("Overlay prvek nebyl nalezen.");
    return;
  }

  overlay.innerHTML = `
    <div class="detail-okno">
      <h3>Směna – ${data.datum} ${data.cas}</h3>
      <p><strong>Vozidlo:</strong> ${data.vozidlo}</p>
      <p><strong>Důvod výjezdu:</strong> ${data.duvod}</p>
      <p><strong>Rozdělení směny:</strong><br/>${data.rozdeleni}</p>
      <p><strong>Náplň směny:</strong><br/>${data.napln}</p>
      <p><strong>Palivo:</strong> ${data.palivo}%</p>
      <p><strong>Voda:</strong> ${data.voda}</p>
      <p><strong>Světla, VRZ, majáky:</strong> ${data.svetla}</p>
      <p><strong>Čisté:</strong> ${data.ciste}</p>
      <p><strong>Technika:</strong> ${data.technika}</p>
      <p><strong>Poznámka:</strong><br/>${data.poznamka}</p>
      <p><em>Autor: ${data.autor}</em></p>
      <button onclick="document.getElementById('overlay').style.display='none'">Zavřít</button>
    </div>
  `;
  overlay.style.display = "flex";
}

window.zobrazDetailSmeny = zobrazDetailSmeny;

// Přepínání sekcí podle kliknutí
document.querySelectorAll(".top-panel a").forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    document.querySelectorAll(".top-panel a").forEach(a => a.classList.remove("active"));
    link.classList.add("active");

    const target = link.getAttribute("href").substring(1);
    document.querySelectorAll("section").forEach(sec => {
      sec.style.display = sec.id === target ? "block" : "none";
    });

    // Aktualizace hash v URL
    window.location.hash = target;
  });
});

// Aktivace sekce podle hash při načtení stránky
window.addEventListener("load", () => {
  const hash = window.location.hash.substring(1) || "vyjezd";

  document.querySelectorAll(".top-panel a").forEach(a => {
    a.classList.remove("active");
    if (a.getAttribute("href").substring(1) === hash) {
      a.classList.add("active");
    }
  });

  document.querySelectorAll("section").forEach(sec => {
    sec.style.display = sec.id === hash ? "block" : "none";
  });
});

</script>
</body>
</html>
